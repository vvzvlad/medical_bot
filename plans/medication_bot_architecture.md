# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Telegram-–±–æ—Ç–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–µ–º–æ–º –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
3. [–§–æ—Ä–º–∞–ª—å–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö](#—Ñ–æ—Ä–º–∞–ª—å–Ω–∞—è-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è-–¥–∞–Ω–Ω—ã—Ö)
4. [–ú–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã](#–º–æ–¥—É–ª–∏-—Å–∏—Å—Ç–µ–º—ã)
5. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Groq LLM](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-groq-llm)
6. [–°–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π](#—Å–∏—Å—Ç–µ–º–∞-–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π)
7. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
8. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ-–∏-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

---

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
Telegram-–±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–∏–µ–º–∞ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—è–∑—ã–∫–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ LLM
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- –ì–∏–±–∫–∏—Ö —Å—Ö–µ–º –ø—Ä–∏–µ–º–∞ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã)
- –ü—Ä–æ—Å—Ç–æ–π –ª–æ–≥–∏–∫–∏: –æ–¥–∏–Ω –ø—Ä–∏–µ–º –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **Python 3.11+**
- **aiogram 3.x** - Telegram Bot API
- **python-dotenv** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- **loguru** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **httpx** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ HTTP-–∑–∞–ø—Ä–æ—Å—ã –∫ Groq API
- **pytz** - —Ä–∞–±–æ—Ç–∞ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∑–æ–Ω–∞–º–∏
- **asyncio** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```mermaid
graph TB
    subgraph "Telegram Bot Layer"
        TG[Telegram API Client]
        MH[Message Handler]
        CH[Callback Handler]
    end
    
    subgraph "Business Logic Layer"
        SM[Schedule Manager]
        NM[Notification Manager]
        LLM[LLM Integration]
    end
    
    subgraph "Data Layer"
        DM[Data Manager]
        FS[File Storage JSON]
    end
    
    subgraph "Background Services"
        SCH[Scheduler Task]
    end
    
    subgraph "External Services"
        TAPI[Telegram API]
        GROQ[Groq LLM API]
    end
    
    TG --> MH
    TG --> CH
    MH --> SM
    MH --> LLM
    CH --> SM
    SM --> DM
    NM --> DM
    LLM --> GROQ
    LLM --> SM
    DM --> FS
    SCH --> NM
    NM --> TG
    TG --> TAPI
    
    style TG fill:#e1f5ff
    style LLM fill:#fff4e1
    style DM fill:#e8f5e9
    style SCH fill:#f3e5f5
```

### –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### 1. Telegram Bot Layer
- **Telegram API Client**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- **Message Handler**: –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
- **Callback Handler**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π inline-–∫–Ω–æ–ø–æ–∫

#### 2. Business Logic Layer
- **Schedule Manager**: CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è–º–∏ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤
- **Notification Manager**: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- **LLM Integration**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—è–∑—ã–∫–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥

#### 3. Data Layer
- **Data Manager**: –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
- **File Storage**: JSON-—Ñ–∞–π–ª—ã –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

#### 4. Background Services
- **Scheduler Task**: –§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏–µ–º–∞

---

## –§–æ—Ä–º–∞–ª—å–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON —Ñ–∞–π–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—É—Ç—å**: `data/users/{user_id}.json`

```json
{
  "user_id": 123456789,
  "timezone": "Europe/Moscow",
  "medications": [
    {
      "medication_id": "med_1703701234567",
      "name": "–ê—Å–ø–∏—Ä–∏–Ω",
      "dosage": "100 –º–≥",
      "schedule_type": "fixed_times",
      "schedule": {
        "times": [
          {"hour": 9, "minute": 0},
          {"hour": 21, "minute": 0}
        ]
      },
      "last_taken": "2024-12-27T18:00:00Z",
      "next_planned_time": "2024-12-28T06:00:00Z",
      "last_reminder_message_id": 12345,
      "active": true,
      "created_at": "2024-12-01T10:00:00Z",
      "updated_at": "2024-12-27T18:00:00Z"
    },
    {
      "medication_id": "med_1703701234568",
      "name": "–í–∏—Ç–∞–º–∏–Ω D",
      "dosage": "2000 –ú–ï",
      "schedule_type": "interval",
      "schedule": {
        "interval_hours": 24
      },
      "last_taken": "2024-12-27T08:30:00Z",
      "next_planned_time": "2024-12-28T08:30:00Z",
      "last_reminder_message_id": null,
      "active": true,
      "created_at": "2024-12-15T10:00:00Z",
      "updated_at": "2024-12-27T08:30:00Z"
    }
  ]
}
```

### –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–µ–π

#### –ö–æ—Ä–Ω–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å
| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|--------------|----------|
| `user_id` | integer | –î–∞ | Telegram user ID |
| `timezone` | string | –î–∞ | IANA timezone (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Europe/Moscow") |
| `medications` | array | –î–∞ | –°–ø–∏—Å–æ–∫ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

#### Medication Object
| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|--------------|----------|
| `medication_id` | string | –î–∞ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (—Ñ–æ—Ä–º–∞—Ç: "med_{timestamp}") |
| `name` | string | –î–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞ |
| `dosage` | string | –î–∞ | –î–æ–∑–∏—Ä–æ–≤–∫–∞ (—Å–≤–æ–±–æ–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç) |
| `schedule_type` | enum | –î–∞ | –¢–∏–ø —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è: "fixed_times" –∏–ª–∏ "interval" |
| `schedule` | object | –î–∞ | –û–±—ä–µ–∫—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç schedule_type) |
| `last_taken` | string/null | –î–∞ | ISO 8601 timestamp —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–µ–º–∞ (UTC) |
| `next_planned_time` | string | –î–∞ | ISO 8601 timestamp —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–ª–∞–Ω–æ–≤–æ–≥–æ –ø—Ä–∏–µ–º–∞ (UTC) |
| `last_reminder_message_id` | integer/null | –î–∞ | ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è-–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è |
| `active` | boolean | –î–∞ | –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç (–¥–ª—è –º—è–≥–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è) |
| `created_at` | string | –î–∞ | ISO 8601 timestamp —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ (UTC) |
| `updated_at` | string | –î–∞ | ISO 8601 timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (UTC) |

#### Schedule Object (fixed_times)
```json
{
  "times": [
    {"hour": 9, "minute": 0},
    {"hour": 14, "minute": 30},
    {"hour": 21, "minute": 0}
  ]
}
```

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `times` | array | –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏–µ–º–∞ |
| `times[].hour` | integer | –ß–∞—Å (0-23) |
| `times[].minute` | integer | –ú–∏–Ω—É—Ç–∞ (0-59) |

#### Schedule Object (interval)
```json
{
  "interval_hours": 8
}
```

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `interval_hours` | integer/float | –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø—Ä–∏–µ–º–∞–º–∏ –≤ —á–∞—Å–∞—Ö |

---

## –ú–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã

### 1. Data Manager (`src/data_manager.py`)

#### –ö–ª–∞—Å—Å: `DataManager`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á—Ç–µ–Ω–∏–µ–º/–∑–∞–ø–∏—Å—å—é –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å—é –∏ –∏–∑–æ–ª—è—Ü–∏–µ–π.

**–ú–µ—Ç–æ–¥—ã**:

```python
class DataManager:
    def __init__(self, data_dir: str = "data/users"):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö."""
        
    async def get_user_data(self, user_id: int) -> dict:
        """–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —Ñ–∞–π–ª –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç."""
        
    async def save_user_data(self, user_id: int, data: dict) -> bool:
        """–ê—Ç–æ–º–∞—Ä–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
        
    async def add_medication(self, user_id: int, medication: dict) -> str:
        """–î–æ–±–∞–≤–∏—Ç—å –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç medication_id."""
        
    async def update_medication(self, user_id: int, medication_id: str, updates: dict) -> bool:
        """–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—è –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞."""
        
    async def delete_medication(self, user_id: int, medication_id: str) -> bool:
        """–ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞ (active=false)."""
        
    async def get_medication(self, user_id: int, medication_id: str) -> dict | None:
        """–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç."""
        
    async def get_all_active_medications(self, user_id: int) -> list[dict]:
        """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
        
    async def mark_taken(self, user_id: int, medication_id: str, taken_at: datetime) -> bool:
        """–û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–∏–µ–º –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞ –∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å next_planned_time."""
        
    async def get_all_users(self) -> list[int]:
        """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö user_id."""
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
- –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª + `os.replace()`
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ `asyncio.Lock` –ø–æ user_id
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è JSON —Å—Ö–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é

---

### 2. Schedule Manager (`src/schedule_manager.py`)

#### –ö–ª–∞—Å—Å: `ScheduleManager`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è–º–∏.

**–ú–µ—Ç–æ–¥—ã**:

```python
class ScheduleManager:
    def __init__(self, data_manager: DataManager):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é –æ—Ç DataManager."""
        
    async def calculate_next_planned_time(
        self, 
        medication: dict, 
        user_timezone: str,
        from_time: datetime | None = None
    ) -> datetime:
        """–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ –ø–ª–∞–Ω–æ–≤–æ–µ –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–∞."""
        
    async def get_pending_medications(
        self, 
        user_id: int, 
        current_time: datetime
    ) -> list[dict]:
        """–ü–æ–ª—É—á–∏—Ç—å –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—ã, –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞—Å—Ç—É–ø–∏–ª–æ."""
        
    async def update_schedule_from_llm(
        self, 
        user_id: int, 
        llm_response: dict
    ) -> dict:
        """–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏–∑ –æ—Ç–≤–µ—Ç–∞ LLM."""
```

**–õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ next_planned_time**:

#### –î–ª—è fixed_times

```python
async def calculate_next_planned_time_fixed(
    self,
    medication: dict,
    user_timezone: str,
    from_time: datetime
) -> datetime:
    """–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ –ø–ª–∞–Ω–æ–≤–æ–µ –≤—Ä–µ–º—è –¥–ª—è fixed_times."""
    
    user_tz = pytz.timezone(user_timezone)
    local_from = from_time.astimezone(user_tz)
    
    times = medication['schedule']['times']
    
    # –ù–∞–π—Ç–∏ —Å–ª–µ–¥—É—é—â–µ–µ –≤—Ä–µ–º—è –∏–∑ —Å–ø–∏—Å–∫–∞
    for time_obj in times:
        next_time = local_from.replace(
            hour=time_obj['hour'],
            minute=time_obj['minute'],
            second=0,
            microsecond=0
        )
        
        if next_time > local_from:
            return next_time.astimezone(timezone.utc)
    
    # –ï—Å–ª–∏ –≤—Å–µ –≤—Ä–µ–º–µ–Ω–∞ —Å–µ–≥–æ–¥–Ω—è –ø—Ä–æ—à–ª–∏, –≤–∑—è—Ç—å –ø–µ—Ä–≤–æ–µ –≤—Ä–µ–º—è –∑–∞–≤—Ç—Ä–∞
    next_time = (local_from + timedelta(days=1)).replace(
        hour=times[0]['hour'],
        minute=times[0]['minute'],
        second=0,
        microsecond=0
    )
    
    return next_time.astimezone(timezone.utc)
```

#### –î–ª—è interval

```python
async def calculate_next_planned_time_interval(
    self,
    medication: dict,
    user_timezone: str,
    from_time: datetime
) -> datetime:
    """–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ –ø–ª–∞–Ω–æ–≤–æ–µ –≤—Ä–µ–º—è –¥–ª—è interval."""
    
    interval_hours = medication['schedule']['interval_hours']
    
    # –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –∫ from_time
    next_time = from_time + timedelta(hours=interval_hours)
    
    return next_time
```

#### –õ–æ–≥–∏–∫–∞ —Ä–∞–Ω–Ω–µ–≥–æ –ø—Ä–∏–µ–º–∞

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω—è–ª –ª–µ–∫–∞—Ä—Å—Ç–≤–æ **—Ä–∞–Ω—å—à–µ** –ø–ª–∞–Ω–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, —Å–ª–µ–¥—É—é—â–∏–π –ø–ª–∞–Ω–æ–≤—ã–π –ø—Ä–∏–µ–º **–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è**.

```python
async def mark_taken(self, user_id: int, medication_id: str, taken_at: datetime) -> bool:
    """–û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–∏–µ–º –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞."""
    
    user_data = await self.get_user_data(user_id)
    medication = next((m for m in user_data['medications'] if m['medication_id'] == medication_id), None)
    
    if not medication:
        return False
    
    # –û–±–Ω–æ–≤–∏—Ç—å last_taken
    medication['last_taken'] = taken_at.isoformat()
    
    # –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –ø–ª–∞–Ω–æ–≤—ã–π –ø—Ä–∏–µ–º –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–µ–º–∞
    next_planned = await self.schedule_manager.calculate_next_planned_time(
        medication,
        user_data['timezone'],
        from_time=taken_at
    )
    
    # –ï—Å–ª–∏ –ø—Ä–∏–Ω—è–ª —Ä–∞–Ω—å—à–µ –ø–ª–∞–Ω–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π –ø–ª–∞–Ω–æ–≤—ã–π –ø—Ä–∏–µ–º
    current_planned = datetime.fromisoformat(medication['next_planned_time'])
    if taken_at < current_planned:
        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–¥–∏–Ω –ø—Ä–∏–µ–º - –±–µ—Ä–µ–º —Å–ª–µ–¥—É—é—â–∏–π –ø–æ—Å–ª–µ next_planned
        next_planned = await self.schedule_manager.calculate_next_planned_time(
            medication,
            user_data['timezone'],
            from_time=next_planned
        )
    
    medication['next_planned_time'] = next_planned.isoformat()
    medication['last_reminder_message_id'] = None  # –°–±—Ä–æ—Å–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
    medication['updated_at'] = datetime.now(timezone.utc).isoformat()
    
    await self.save_user_data(user_id, user_data)
    return True
```

**–ü—Ä–∏–º–µ—Ä**:
```
–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: –ê—Å–ø–∏—Ä–∏–Ω –∫–∞–∂–¥—ã–µ 8 —á–∞—Å–æ–≤ (08:00, 16:00, 00:00)

–°—Ü–µ–Ω–∞—Ä–∏–π:
- 08:00 - –ø–ª–∞–Ω–æ–≤—ã–π –ø—Ä–∏–µ–º
- 07:30 - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω—è–ª —Ä–∞–Ω—å—à–µ
- 16:00 - –ü–†–û–ü–£–°–ö–ê–ï–ú —ç—Ç–æ—Ç –ø—Ä–∏–µ–º
- 00:00 - —Å–ª–µ–¥—É—é—â–µ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
```

#### –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–∏–µ–º–æ–≤

–•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ **–ø–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–π –ø—Ä–∏–µ–º**. –û–¥–∏–Ω –ø—Ä–∏–µ–º –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ.

```python
async def get_pending_medications(
    self, 
    user_id: int, 
    current_time: datetime
) -> list[dict]:
    """–ü–æ–ª—É—á–∏—Ç—å –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è."""
    
    user_data = await self.data_manager.get_user_data(user_id)
    pending = []
    
    for med in user_data['medications']:
        if not med['active']:
            continue
            
        next_planned = datetime.fromisoformat(med['next_planned_time'])
        
        # –ü—Ä–æ—Å—Ç–æ–µ —É—Å–ª–æ–≤–∏–µ: –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ –Ω–∞—Å—Ç—É–ø–∏–ª–æ –∏ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç –Ω–µ –ø—Ä–∏–Ω—è—Ç
        if next_planned <= current_time:
            last_taken = med.get('last_taken')
            
            # –ï—Å–ª–∏ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–ª–∏ –≤–æ–æ–±—â–µ –∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–∏–µ–º –±—ã–ª –¥–æ –ø–ª–∞–Ω–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
            if last_taken is None or datetime.fromisoformat(last_taken) < next_planned:
                pending.append(med)
    
    # –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ next_planned_time
    pending.sort(key=lambda m: m['next_planned_time'])
    
    return pending
```

**–ü—Ä–∏–º–µ—Ä**:
```
–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: –í–∏—Ç–∞–º–∏–Ω D –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 09:00

–°—Ü–µ–Ω–∞—Ä–∏–π:
- 27.12 09:00 - –ø—Ä–æ–ø—É—â–µ–Ω
- 28.12 09:00 - –ø—Ä–æ–ø—É—â–µ–Ω  
- 29.12 09:00 - –ø—Ä–æ–ø—É—â–µ–Ω
- 29.12 10:00 - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω—è–ª

–†–µ–∑—É–ª—å—Ç–∞—Ç: –í—Å–µ 3 –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–∏–µ–º–∞ –∑–∞–∫—Ä—ã—Ç—ã –æ–¥–Ω–∏–º –ø—Ä–∏–µ–º–æ–º
–°–ª–µ–¥—É—é—â–µ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: 30.12 09:00
```

---

### 3. Notification Manager (`src/notification_manager.py`)

#### –ö–ª–∞—Å—Å: `NotificationManager`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π.

**–ú–µ—Ç–æ–¥—ã**:

```python
class NotificationManager:
    def __init__(self, bot: Bot, schedule_manager: ScheduleManager):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏."""
        
    async def send_reminder(
        self, 
        user_id: int, 
        medications: list[dict]
    ) -> int | None:
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç message_id."""
        
    async def update_reminder(
        self, 
        user_id: int, 
        message_id: int, 
        medications: list[dict]
    ) -> bool:
        """–û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ."""
        
    async def delete_reminder(
        self, 
        user_id: int, 
        message_id: int
    ) -> bool:
        """–£–¥–∞–ª–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ."""
        
    def build_reminder_text(self, medications: list[dict]) -> str:
        """–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è."""
        
    def build_inline_keyboard(
        self, 
        medications: list[dict]
    ) -> InlineKeyboardMarkup:
        """–°–æ–∑–¥–∞—Ç—å inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞."""
```

**–§–æ—Ä–º–∞—Ç —Ç–µ–∫—Å—Ç–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è**:
```
üíä –í—Ä–µ–º—è –ø—Ä–∏–Ω—è—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–∞:

‚Ä¢ –ê—Å–ø–∏—Ä–∏–Ω 100 –º–≥
‚Ä¢ –í–∏—Ç–∞–º–∏–Ω D 2000 –ú–ï
```

**–§–æ—Ä–º–∞—Ç callback_data**:
```
take:{medication_id}
```

**–õ–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π**:
1. –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–æ–≤–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —É–¥–∞–ª–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–µ–µ (–µ—Å–ª–∏ `last_reminder_message_id` –Ω–µ null)
2. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏:
   - –£–¥–∞–ª–∏—Ç—å –∫–Ω–æ–ø–∫—É –ø—Ä–∏–Ω—è—Ç–æ–≥–æ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞
   - –ï—Å–ª–∏ –≤—Å–µ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω—ã, –∑–∞–º–µ–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ "‚úÖ –í—Å–µ –ø—Ä–∏–Ω—è—Ç–æ!"
3. –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–ø—Ä–∏–Ω—è—Ç—ã–µ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—ã, –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤–æ–µ)

---

### 4. LLM Integration (`src/llm_integration.py`)

#### –ö–ª–∞—Å—Å: `LLMIntegration`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—è–∑—ã–∫–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ Groq API.

**–ú–µ—Ç–æ–¥—ã**:

```python
class LLMIntegration:
    def __init__(self, api_key: str):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å API –∫–ª—é—á–æ–º."""
        
    async def parse_schedule_command(
        self, 
        user_id: int,
        current_schedule: dict,
        user_message: str,
        user_timezone: str
    ) -> dict:
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–º–∞–Ω–¥—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è."""
```

**–§–æ—Ä–º–∞—Ç –ø—Ä–æ–º–ø—Ç–∞**:

```python
system_prompt = f"""
–¢—ã - –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–∏–µ–º–∞ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤.

–¢–ï–ö–£–©–ï–ï –†–ê–°–ü–ò–°–ê–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
{json.dumps(current_schedule, ensure_ascii=False, indent=2)}

–í–†–ï–ú–ï–ù–ù–ê–Ø –ó–û–ù–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø: {user_timezone}
–¢–ï–ö–£–©–ï–ï –í–†–ï–ú–Ø: {current_time_str}

–ü–û–î–î–ï–†–ñ–ò–í–ê–ï–ú–´–ï –û–ü–ï–†–ê–¶–ò–ò:
1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞
2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏–µ–º–∞
3. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–æ–∑–∏—Ä–æ–≤–∫–∏
4. –£–¥–∞–ª–µ–Ω–∏–µ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞
5. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è / –∏–Ω—Ç–µ—Ä–≤–∞–ª)

–¢–ò–ü–´ –†–ê–°–ü–ò–°–ê–ù–ò–ô:

1. –§–ò–ö–°–ò–†–û–í–ê–ù–ù–û–ï –í–†–ï–ú–Ø (fixed_times):
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –≤—Ä–µ–º–µ–Ω–∞–º–∏ –ø—Ä–∏–µ–º–∞
   - –ü—Ä–∏–º–µ—Ä—ã: "—É—Ç—Ä–æ–º –∏ –≤–µ—á–µ—Ä–æ–º", "–≤ 9:00, 14:00 –∏ 21:00", "3 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å"
   - –§–æ—Ä–º–∞—Ç: {{"times": [{{"hour": 9, "minute": 0}}, {{"hour": 21, "minute": 0}}]}}

2. –ò–ù–¢–ï–†–í–ê–õ (interval):
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤ —Å –ø—Ä–∏–µ–º–æ–º "–∫–∞–∂–¥—ã–µ N —á–∞—Å–æ–≤"
   - –ü—Ä–∏–º–µ—Ä—ã: "–∫–∞–∂–¥—ã–µ 8 —á–∞—Å–æ–≤", "–∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤", "—Ä–∞–∑ –≤ —Å—É—Ç–∫–∏"
   - –§–æ—Ä–º–∞—Ç: {{"interval_hours": 8}}

–í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê:
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω—è–ª –ª–µ–∫–∞—Ä—Å—Ç–≤–æ —Ä–∞–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, —Å–ª–µ–¥—É—é—â–∏–π –ø–ª–∞–Ω–æ–≤—ã–π –ø—Ä–∏–µ–º –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
- –û–¥–∏–Ω –ø—Ä–∏–µ–º –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–∏–µ–º—ã
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç, –∫–æ–≥–¥–∞ —á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (—Å—Ç—Ä–æ–≥–∏–π JSON):
{{
  "action": "add" | "update" | "delete" | "error",
  "medication_id": "med_xxx" –∏–ª–∏ null –¥–ª—è –Ω–æ–≤—ã—Ö,
  "changes": {{
    "name": "–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞",
    "dosage": "100 –º–≥",
    "schedule_type": "fixed_times" | "interval",
    "schedule": {{
      // –î–ª—è fixed_times:
      "times": [{{"hour": 9, "minute": 0}}]
      // –î–ª—è interval:
      "interval_hours": 24
    }}
  }},
  "confirmation_message": "–¢–µ–∫—Å—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
  "error_message": null –∏–ª–∏ "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏"
}}

–ü–†–ò–ú–ï–†–´:

–ö–æ–º–∞–Ω–¥–∞: "–î–æ–±–∞–≤—å –∞—Å–ø–∏—Ä–∏–Ω 100 –º–≥ —É—Ç—Ä–æ–º –∏ –≤–µ—á–µ—Ä–æ–º"
–û—Ç–≤–µ—Ç: {{
  "action": "add",
  "medication_id": null,
  "changes": {{
    "name": "–ê—Å–ø–∏—Ä–∏–Ω",
    "dosage": "100 –º–≥",
    "schedule_type": "fixed_times",
    "schedule": {{"times": [{{"hour": 9, "minute": 0}}, {{"hour": 21, "minute": 0}}]}}
  }},
  "confirmation_message": "–î–æ–±–∞–≤–ª–µ–Ω –ê—Å–ø–∏—Ä–∏–Ω 100 –º–≥, –ø—Ä–∏–µ–º –≤ 09:00 –∏ 21:00",
  "error_message": null
}}

–ö–æ–º–∞–Ω–¥–∞: "–î–æ–±–∞–≤—å –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫ –∫–∞–∂–¥—ã–µ 8 —á–∞—Å–æ–≤"
–û—Ç–≤–µ—Ç: {{
  "action": "add",
  "medication_id": null,
  "changes": {{
    "name": "–ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫",
    "dosage": "–ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é –≤—Ä–∞—á–∞",
    "schedule_type": "interval",
    "schedule": {{"interval_hours": 8}}
  }},
  "confirmation_message": "–î–æ–±–∞–≤–ª–µ–Ω –ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫, –ø—Ä–∏–µ–º –∫–∞–∂–¥—ã–µ 8 —á–∞—Å–æ–≤",
  "error_message": null
}}

Return ONLY the JSON object without any additional text or explanation.
"""
```

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ LLM**:

```json
{
  "action": "add",
  "medication_id": null,
  "changes": {
    "name": "–û–º–µ–≥–∞-3",
    "dosage": "1000 –º–≥",
    "schedule_type": "fixed_times",
    "schedule": {
      "times": [{"hour": 9, "minute": 0}]
    }
  },
  "confirmation_message": "–î–æ–±–∞–≤–ª–µ–Ω –û–º–µ–≥–∞-3 1000 –º–≥, –ø—Ä–∏–µ–º –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 09:00",
  "error_message": null
}
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:
- Timeout (30 —Å–µ–∫—É–Ω–¥) ‚Üí retry 2 —Ä–∞–∑–∞ —Å exponential backoff
- HTTP 429 (rate limit) ‚Üí retry —á–µ—Ä–µ–∑ –≤—Ä–µ–º—è –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Retry-After
- HTTP 5xx ‚Üí retry 3 —Ä–∞–∑–∞
- –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON ‚Üí –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É—Ç–æ—á–Ω–µ–Ω–∏–µ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- action="error" ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å error_message –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

### 5. Scheduler Task (`src/scheduler.py`)

#### –ö–ª–∞—Å—Å: `MedicationScheduler`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏–µ–º–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π.

**–ú–µ—Ç–æ–¥—ã**:

```python
class MedicationScheduler:
    def __init__(
        self, 
        data_manager: DataManager,
        schedule_manager: ScheduleManager,
        notification_manager: NotificationManager
    ):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏."""
        
    async def start(self):
        """–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ñ–æ–Ω–æ–≤—É—é –∑–∞–¥–∞—á—É."""
        
    async def stop(self):
        """–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–æ–Ω–æ–≤—É—é –∑–∞–¥–∞—á—É."""
        
    async def check_and_notify(self):
        """–û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)."""
        
    async def process_user(self, user_id: int):
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
```

**–ê–ª–≥–æ—Ä–∏—Ç–º check_and_notify (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)**:

```python
async def check_and_notify(self):
    """–û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)."""
    
    current_time = datetime.now(timezone.utc)
    all_users = await self.data_manager.get_all_users()
    
    # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
    tasks = [self.process_user(user_id, current_time) for user_id in all_users]
    await asyncio.gather(*tasks, return_exceptions=True)


async def process_user(self, user_id: int, current_time: datetime):
    """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
    
    try:
        # –ü–æ–ª—É—á–∏—Ç—å –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
        pending_meds = await self.schedule_manager.get_pending_medications(
            user_id, 
            current_time
        )
        
        if not pending_meds:
            return
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
        active_reminder_id = None
        for med in pending_meds:
            if med.get('last_reminder_message_id'):
                active_reminder_id = med['last_reminder_message_id']
                break
        
        if active_reminder_id:
            # –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
            await self.notification_manager.update_reminder(
                user_id, 
                active_reminder_id, 
                pending_meds
            )
        else:
            # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
            message_id = await self.notification_manager.send_reminder(
                user_id, 
                pending_meds
            )
            
            # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å message_id –¥–ª—è –≤—Å–µ—Ö –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤
            for med in pending_meds:
                await self.data_manager.update_medication(
                    user_id,
                    med['medication_id'],
                    {'last_reminder_message_id': message_id}
                )
                
    except Exception as e:
        logger.error(f"Error processing user {user_id}: {e}", exc_info=True)
```

**–ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏**: –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É

---

### 6. Callback Handler (`src/handlers/callback_handler.py`)

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `handle_take_medication`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π inline-–∫–Ω–æ–ø–æ–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø—Ä–∏–µ–º–∞.

```python
@router.callback_query(F.data.startswith("take:"))
async def handle_take_medication(
    callback: CallbackQuery,
    data_manager: DataManager,
    schedule_manager: ScheduleManager,
    notification_manager: NotificationManager
):
    """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∏–µ–º–∞ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞."""
    
    # –ü–∞—Ä—Å–∏–Ω–≥ callback_data
    medication_id = callback.data.split(":")[1]
    user_id = callback.from_user.id
    taken_at = datetime.now(timezone.utc)
    
    try:
        # –û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–∏–µ–º
        success = await data_manager.mark_taken(user_id, medication_id, taken_at)
        
        if not success:
            await callback.answer("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏", show_alert=True)
            return
        
        # –ü–æ–ª—É—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –Ω–µ–ø—Ä–∏–Ω—è—Ç—ã—Ö –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤ –∏–∑ —ç—Ç–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
        user_data = await data_manager.get_user_data(user_id)
        message_id = callback.message.message_id
        
        remaining_meds = [
            med for med in user_data['medications']
            if med.get('last_reminder_message_id') == message_id
            and med.get('last_taken') is None
            and med['active']
        ]
        
        if remaining_meds:
            # –û–±–Ω–æ–≤–∏—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É (—É–±—Ä–∞—Ç—å –∫–Ω–æ–ø–∫—É –ø—Ä–∏–Ω—è—Ç–æ–≥–æ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞)
            await notification_manager.update_reminder(
                user_id,
                message_id,
                remaining_meds
            )
            await callback.answer("‚úÖ –û—Ç–º–µ—á–µ–Ω–æ")
        else:
            # –í—Å–µ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—ã –ø—Ä–∏–Ω—è—Ç—ã - –∑–∞–º–µ–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
            await callback.message.edit_text(
                "‚úÖ –í—Å–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ –ø—Ä–∏–Ω—è—Ç—ã!",
                reply_markup=None
            )
            await callback.answer("‚úÖ –í—Å–µ –ø—Ä–∏–Ω—è—Ç–æ!")
            
    except Exception as e:
        logger.error(f"Error handling take callback: {e}", exc_info=True)
        await callback.answer("‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞", show_alert=True)
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Groq LLM

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```python
# src/config.py
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    telegram_bot_token: str
    groq_api_key: str
    groq_model: str = "openai/gpt-oss-120b"
    groq_timeout: int = 30
    groq_max_retries: int = 3
    
    class Config:
        env_file = ".env"
        env_file_encoding = "utf-8"
```

### Retry-–ª–æ–≥–∏–∫–∞ –¥–ª—è Groq API

```python
async def make_llm_request_with_retry(
    self,
    messages: list[dict],
    max_retries: int = 3
) -> dict | None:
    """–í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ LLM —Å retry-–ª–æ–≥–∏–∫–æ–π."""
    
    for attempt in range(max_retries):
        try:
            async with httpx.AsyncClient(timeout=30.0) as client:
                response = await client.post(
                    "https://api.groq.com/openai/v1/chat/completions",
                    headers={
                        "Authorization": f"Bearer {self.api_key}",
                        "Content-Type": "application/json"
                    },
                    json={
                        "model": self.model,
                        "messages": messages,
                        "temperature": 0.3,
                        "response_format": {"type": "json_object"}
                    }
                )
                
                if response.status_code == 200:
                    return response.json()
                    
                elif response.status_code == 429:
                    # Rate limit - –∂–¥–µ–º –≤—Ä–µ–º—è –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                    retry_after = int(response.headers.get("Retry-After", 60))
                    logger.warning(f"Rate limit hit, waiting {retry_after}s")
                    await asyncio.sleep(retry_after)
                    continue
                    
                elif response.status_code >= 500:
                    # Server error - exponential backoff
                    wait_time = 2 ** attempt
                    logger.warning(f"Server error {response.status_code}, retry in {wait_time}s")
                    await asyncio.sleep(wait_time)
                    continue
                    
                else:
                    # Client error - –Ω–µ retry
                    logger.error(f"LLM API error {response.status_code}: {response.text}")
                    return None
                    
        except httpx.TimeoutException:
            wait_time = 2 ** attempt
            logger.warning(f"Request timeout, retry {attempt+1}/{max_retries} in {wait_time}s")
            await asyncio.sleep(wait_time)
            continue
            
        except Exception as e:
            logger.error(f"Unexpected error in LLM request: {e}", exc_info=True)
            return None
    
    logger.error(f"All {max_retries} retry attempts failed")
    return None
```

---

## –°–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–±—ã—á–Ω—ã–π –ø—Ä–∏–µ–º

```
09:00 - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: "üíä –ê—Å–ø–∏—Ä–∏–Ω 100 –º–≥"
09:05 - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ü—Ä–∏–Ω—è–ª"
21:00 - –°–ª–µ–¥—É—é—â–µ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –†–∞–Ω–Ω–∏–π –ø—Ä–∏–µ–º

```
08:30 - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ü—Ä–∏–Ω—è–ª" (—Ä–∞–Ω—å—à–µ 09:00)
09:00 - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è (–ø—Ä–æ–ø—É—â–µ–Ω–æ)
21:00 - –°–ª–µ–¥—É—é—â–µ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–∏–µ–º—ã

```
27.12 09:00 - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, –Ω–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ
28.12 09:00 - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ (—Ç–æ—Ç –∂–µ message)
29.12 09:00 - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ (—Ç–æ—Ç –∂–µ message)
29.12 10:00 - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–ª Telegram, –Ω–∞–∂–∞–ª "–ü—Ä–∏–Ω—è–ª"
30.12 09:00 - –°–ª–µ–¥—É—é—â–µ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ (–≤—Å–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–∞–∫—Ä—ã—Ç—ã)
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ù–æ—á–Ω—ã–µ –ø—Ä–∏–µ–º—ã (–∏–Ω—Ç–µ—Ä–≤–∞–ª)

```
–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: –∫–∞–∂–¥—ã–µ 8 —á–∞—Å–æ–≤

16:00 - –ü—Ä–∏–Ω—è–ª
00:00 - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø–∏—Ç, –Ω–µ —á–∏—Ç–∞–µ—Ç)
08:00 - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ (—Ç–æ—Ç –∂–µ message)
09:00 - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–Ω—É–ª—Å—è, –æ—Ç–∫—Ä—ã–ª Telegram, –Ω–∞–∂–∞–ª "–ü—Ä–∏–Ω—è–ª"
17:00 - –°–ª–µ–¥—É—é—â–µ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ (09:00 + 8 —á–∞—Å–æ–≤)
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏

‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** - –º–µ–Ω—å—à–µ –∫–æ–¥–∞, –º–µ–Ω—å—à–µ —É—Å–ª–æ–≤–∏–π, –º–µ–Ω—å—à–µ edge cases  
‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è** - –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
‚úÖ **–ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫** - –º–µ–Ω—å—à–µ –º–µ—Å—Ç –¥–ª—è –±–∞–≥–æ–≤, –ø—Ä–æ—â–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å  
‚úÖ **–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç, –∫–æ–≥–¥–∞ —á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

#### 1. Telegram API –æ—à–∏–±–∫–∏

```python
class TelegramErrorHandler:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ Telegram API."""
    
    @staticmethod
    async def handle_send_message_error(
        error: Exception,
        user_id: int,
        retry_count: int = 0,
        max_retries: int = 3
    ) -> bool:
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è."""
        
        if isinstance(error, TelegramBadRequest):
            if "chat not found" in str(error).lower():
                logger.warning(f"User {user_id} blocked bot or deleted chat")
                # –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                return False
                
            elif "message is not modified" in str(error).lower():
                # –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å - –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ
                return True
                
        elif isinstance(error, TelegramRetryAfter):
            # Rate limit - –∂–¥–µ–º —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
            wait_time = error.retry_after
            logger.warning(f"Rate limit, waiting {wait_time}s")
            await asyncio.sleep(wait_time)
            return True  # –ú–æ–∂–Ω–æ retry
            
        elif isinstance(error, TelegramNetworkError):
            if retry_count < max_retries:
                wait_time = 2 ** retry_count
                logger.warning(f"Network error, retry {retry_count+1}/{max_retries} in {wait_time}s")
                await asyncio.sleep(wait_time)
                return True  # –ú–æ–∂–Ω–æ retry
                
        logger.error(f"Unhandled Telegram error for user {user_id}: {error}", exc_info=True)
        return False
```

#### 2. LLM API –æ—à–∏–±–∫–∏

```python
class LLMErrorHandler:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ LLM API."""
    
    @staticmethod
    def get_fallback_response(error_type: str) -> dict:
        """–ü–æ–ª—É—á–∏—Ç—å fallback –æ—Ç–≤–µ—Ç –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ LLM."""
        
        return {
            "action": "error",
            "medication_id": None,
            "changes": None,
            "confirmation_message": None,
            "error_message": (
                "–ò–∑–≤–∏–Ω–∏—Ç–µ, —Å–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. "
                "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã /add, /edit, /delete"
            )
        }
    
    @staticmethod
    async def handle_llm_error(
        error: Exception,
        user_message: str
    ) -> dict:
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É LLM –∑–∞–ø—Ä–æ—Å–∞."""
        
        if isinstance(error, httpx.TimeoutException):
            logger.error(f"LLM timeout for message: {user_message[:50]}")
            return LLMErrorHandler.get_fallback_response("timeout")
            
        elif isinstance(error, json.JSONDecodeError):
            logger.error(f"Invalid JSON from LLM: {error}")
            return {
                "action": "error",
                "error_message": (
                    "–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∫–æ–º–∞–Ω–¥—É. "
                    "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–∞—á–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –º–µ–Ω—é."
                )
            }
            
        else:
            logger.error(f"Unexpected LLM error: {error}", exc_info=True)
            return LLMErrorHandler.get_fallback_response("unknown")
```

#### 3. –û—à–∏–±–∫–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

```python
class FileSystemErrorHandler:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã."""
    
    @staticmethod
    async def safe_write_json(
        filepath: Path,
        data: dict,
        backup: bool = True
    ) -> bool:
        """–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–ø–∏—Å—å JSON —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º."""
        
        try:
            # –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –µ—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if backup and filepath.exists():
                backup_path = filepath.with_suffix('.json.bak')
                shutil.copy2(filepath, backup_path)
            
            # –ó–∞–ø–∏—Å–∞—Ç—å –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
            temp_path = filepath.with_suffix('.json.tmp')
            async with aiofiles.open(temp_path, 'w', encoding='utf-8') as f:
                await f.write(json.dumps(data, ensure_ascii=False, indent=2))
            
            # –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–º–µ–Ω–∞
            temp_path.replace(filepath)
            
            # –£–¥–∞–ª–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
            if backup and backup_path.exists():
                backup_path.unlink()
                
            return True
            
        except OSError as e:
            logger.error(f"Failed to write {filepath}: {e}", exc_info=True)
            
            # –ü–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
            if backup and backup_path.exists():
                try:
                    shutil.copy2(backup_path, filepath)
                    logger.info(f"Restored {filepath} from backup")
                except Exception as restore_error:
                    logger.error(f"Failed to restore backup: {restore_error}")
                    
            return False
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# src/logging_config.py
from loguru import logger
import sys

def setup_logging(log_level: str = "INFO"):
    """–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ."""
    
    # –£–¥–∞–ª–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π handler
    logger.remove()
    
    # Console handler —Å —Ü–≤–µ—Ç–∞–º–∏
    logger.add(
        sys.stderr,
        format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> - <level>{message}</level>",
        level=log_level,
        colorize=True
    )
    
    # File handler –¥–ª—è –≤—Å–µ—Ö –ª–æ–≥–æ–≤
    logger.add(
        "logs/bot_{time:YYYY-MM-DD}.log",
        rotation="00:00",
        retention="30 days",
        level="DEBUG",
        format="{time:YYYY-MM-DD HH:mm:ss} | {level: <8} | {name}:{function}:{line} - {message}",
        encoding="utf-8"
    )
    
    # File handler —Ç–æ–ª—å–∫–æ –¥–ª—è –æ—à–∏–±–æ–∫
    logger.add(
        "logs/errors_{time:YYYY-MM-DD}.log",
        rotation="00:00",
        retention="90 days",
        level="ERROR",
        format="{time:YYYY-MM-DD HH:mm:ss} | {level: <8} | {name}:{function}:{line} - {message}\n{exception}",
        encoding="utf-8"
    )
```

---

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
medical_bot/
‚îú‚îÄ‚îÄ .env                          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ .env.example                  # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ main.py                       # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ data/                         # –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ users/
‚îÇ       ‚îú‚îÄ‚îÄ 123456789.json
‚îÇ       ‚îî‚îÄ‚îÄ 987654321.json
‚îú‚îÄ‚îÄ logs/                         # –õ–æ–≥–∏
‚îÇ   ‚îú‚îÄ‚îÄ bot_2024-12-27.log
‚îÇ   ‚îî‚îÄ‚îÄ errors_2024-12-27.log
‚îú‚îÄ‚îÄ plans/                        # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ medication_bot_architecture.md
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ config.py                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ logging_config.py         # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    ‚îú‚îÄ‚îÄ bot.py                    # –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –±–æ—Ç–∞
    ‚îú‚îÄ‚îÄ data_manager.py           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏
    ‚îú‚îÄ‚îÄ schedule_manager.py       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è–º–∏
    ‚îú‚îÄ‚îÄ notification_manager.py   # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
    ‚îú‚îÄ‚îÄ llm_integration.py        # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM
    ‚îú‚îÄ‚îÄ scheduler.py              # –§–æ–Ω–æ–≤—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
    ‚îú‚îÄ‚îÄ error_handlers.py         # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫
    ‚îî‚îÄ‚îÄ handlers/
        ‚îú‚îÄ‚îÄ __init__.py
        ‚îú‚îÄ‚îÄ message_handler.py    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
        ‚îî‚îÄ‚îÄ callback_handler.py   # –û–±—Ä–∞–±–æ—Ç–∫–∞ callback
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (.env)

```bash
# Telegram Bot
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# Groq LLM
GROQ_API_KEY=gsk_xxxxxxxxxxxxxxxxxxxxxxxxxxxx
GROQ_MODEL=openai/gpt-oss-120b
GROQ_TIMEOUT=30
GROQ_MAX_RETRIES=3

# Application
LOG_LEVEL=INFO
DATA_DIR=data/users
SCHEDULER_INTERVAL_SECONDS=60

# Timezone (default for new users)
DEFAULT_TIMEZONE=Europe/Moscow
```

### Docker Compose

```yaml
version: '3.8'

services:
  bot:
    build: .
    container_name: medication_bot
    restart: unless-stopped
    env_file:
      - .env
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
```

### Dockerfile

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
RUN mkdir -p data/users logs

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
COPY main.py .
COPY src/ src/

# –ó–∞–ø—É—Å–∫
CMD ["python", "main.py"]
```

### requirements.txt

```
aiogram==3.4.1
python-dotenv==1.0.0
loguru==0.7.2
httpx==0.26.0
pytz==2023.3
aiofiles==23.2.1
pydantic==2.5.3
pydantic-settings==2.1.0
```

### main.py

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import asyncio
import sys
from pathlib import Path

from loguru import logger

from src.config import get_settings
from src.logging_config import setup_logging
from src.bot import MedicationBot


async def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞."""
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    settings = get_settings()
    setup_logging(settings.log_level)
    
    logger.info("Starting Medication Bot...")
    logger.info(f"Data directory: {settings.data_dir}")
    logger.info(f"Log level: {settings.log_level}")
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
    Path(settings.data_dir).mkdir(parents=True, exist_ok=True)
    Path("logs").mkdir(exist_ok=True)
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
    bot = MedicationBot(settings)
    
    try:
        await bot.start()
    except KeyboardInterrupt:
        logger.info("Received interrupt signal, shutting down...")
    except Exception as e:
        logger.error(f"Fatal error: {e}", exc_info=True)
        sys.exit(1)
    finally:
        await bot.stop()
        logger.info("Bot stopped")


if __name__ == "__main__":
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        logger.info("Interrupted by user")
```

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository_url>
cd medical_bot

# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env –∏ –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω—ã

# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
docker-compose restart

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps
```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (–±—É–¥—É—â–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)

### 1. –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

```python
@router.message(Command("export"))
async def cmd_export(message: Message, data_manager: DataManager):
    """–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤ JSON."""
    
    user_data = await data_manager.get_user_data(message.from_user.id)
    
    # –°–æ–∑–¥–∞—Ç—å JSON —Ñ–∞–π–ª
    json_data = json.dumps(user_data, ensure_ascii=False, indent=2)
    
    # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç
    file = BufferedInputFile(
        json_data.encode('utf-8'),
        filename=f"schedule_{message.from_user.id}.json"
    )
    
    await message.answer_document(
        file,
        caption="üìã –í–∞—à–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–µ–º–∞ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤"
    )
```

### 2. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–µ–º–∞

```python
@router.message(Command("stats"))
async def cmd_stats(message: Message, data_manager: DataManager):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏–µ–º–∞ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤."""
    
    user_data = await data_manager.get_user_data(message.from_user.id)
    
    # –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
    stats = calculate_adherence_stats(user_data, days=30)
    
    text = f"""
üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π**:

‚Ä¢ –í—Å–µ–≥–æ –ø—Ä–∏–µ–º–æ–≤: {stats['total_scheduled']}
‚Ä¢ –ü—Ä–∏–Ω—è—Ç–æ –≤–æ–≤—Ä–µ–º—è: {stats['taken_on_time']} ({stats['on_time_rate']:.1%})
‚Ä¢ –ü—Ä–∏–Ω—è—Ç–æ —Å –æ–ø–æ–∑–¥–∞–Ω–∏–µ–º: {stats['taken_late']} ({stats['late_rate']:.1%})
‚Ä¢ –ü—Ä–æ–ø—É—â–µ–Ω–æ: {stats['missed']} ({stats['missed_rate']:.1%})

üèÜ –ü—Ä–æ—Ü–µ–Ω—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏—è: {stats['adherence_rate']:.1%}
"""
    
    await message.answer(text, parse_mode="Markdown")
```

### 3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏—Ö—Å—è –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∞—Ö

```python
# –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –≤ medication:
{
    "stock_quantity": 30,  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–µ—Ç–æ–∫/–¥–æ–∑
    "stock_alert_threshold": 5  # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –∫–æ–≥–¥–∞ –æ—Å—Ç–∞–ª–æ—Å—å 5
}

# –í –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ—Å—Ç–∞—Ç–æ–∫
async def check_stock_alerts(user_id: int, data_manager: DataManager):
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤."""
    
    user_data = await data_manager.get_user_data(user_id)
    
    for med in user_data['medications']:
        if not med.get('stock_quantity'):
            continue
            
        if med['stock_quantity'] <= med.get('stock_alert_threshold', 5):
            await send_stock_alert(user_id, med)
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–î–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, retry-–ª–æ–≥–∏–∫–∞, —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ  
‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ö–µ–º –ø—Ä–∏–µ–º–∞ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤  
‚úÖ **–£–¥–æ–±—Å—Ç–≤–æ**: –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—è–∑—ã–∫–æ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–µ—Ä–µ–∑ LLM  
‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ - –æ–¥–∏–Ω –ø—Ä–∏–µ–º –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ  
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫  

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.
